<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiAppMinhasCompras.Views.ListaProduto"
             Title="Minhas Compras"
             BackgroundColor="MintCream">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Somar" Clicked="OnSomarClicked" />
    </ContentPage.ToolbarItems>

    <Grid x:Name="MainGrid" Padding="10">

        <!-- Envolvemos todo em ScrollView -->
        <ScrollView x:Name="ScrollViewContent">
            <StackLayout x:Name="StackContent">

                <!-- Barra de busca -->
                <SearchBar x:Name="searchBar"
                           Placeholder="Busque o Produto"
                           PlaceholderColor="Gray"
                           TextChanged="OnSearchTextChanged"
                           BackgroundColor="#F5F5F5" />

                <!-- Tabela com cabeçalho fixo e rolagem interna -->
                <Frame Padding="0" Margin="10" BorderColor="Gray" HeightRequest="300">
                    <Grid RowDefinitions="Auto,*">

                        <!-- Cabeçalho fixo -->
                        <Grid ColumnDefinitions="100,80,50,90" BackgroundColor="#87CEFA" Padding="10">
                            <Label Grid.Column="0" Text="Descrição" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Text="Preço" FontAttributes="Bold"/>
                            <Label Grid.Column="2" Text="Qtd" FontAttributes="Bold"/>
                            <Label Grid.Column="3" Text="Total" FontAttributes="Bold"/>
                        </Grid>

                        <!-- Conteúdo rolável -->
                        <CollectionView x:Name="collectionViewProdutos"
                                        Grid.Row="1"
                                        HeightRequest="260"
                                        SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <SwipeView>
                                        <!-- Ações de swipe -->
                                        <SwipeView.RightItems>
                                            <SwipeItems Mode="Execute">
                                                <SwipeItem Text="Editar" BackgroundColor="Aqua" 
                                                           Invoked="EditarProduto_Swipe"/>
                                            </SwipeItems>
                                        </SwipeView.RightItems>

                                        <SwipeView.LeftItems>
                                            <SwipeItems Mode="Execute">
                                                <SwipeItem Text="Excluir" BackgroundColor="Red" 
                                                           Invoked="ExcluirProduto_Swipe"/>
                                            </SwipeItems>
                                        </SwipeView.LeftItems>
                                        
                                        <!-- Conteúdo do item (apenas UM filho direto) -->
                                        <Grid ColumnDefinitions="100,80,50,90" Padding="10" BackgroundColor="LightGray">
                                            <Label Grid.Column="0" Text="{Binding Descricao}" TextColor="Black"/>
                                            <Label Grid.Column="1" Text="{Binding Preco, StringFormat='R${0:F2}'}" TextColor="Black"/>
                                            <Label Grid.Column="2" Text="{Binding Quantidade}" TextColor="Black"/>
                                            <Label Grid.Column="3" Text="{Binding Total, StringFormat='R${0:F2}'}" TextColor="Black"/>
                                        </Grid>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </Grid>
                </Frame>

            </StackLayout>
        </ScrollView>

        <!-- Botão flutuante -->
        <Button x:Name="addbutton"
                WidthRequest="60"
                HeightRequest="60"
                BackgroundColor="DodgerBlue"
                Text="+"
                TextColor="White"
                FontSize="30"
                CornerRadius="30"
                Clicked="OnAddButton_Clicked"
                AbsoluteLayout.LayoutBounds="1,1,60,60"
                AbsoluteLayout.LayoutFlags="PositionProportional"
                VerticalOptions="End"
                HorizontalOptions="End"
                Margin="20"/>
    </Grid>
</ContentPage>
